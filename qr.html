<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Keine Kommunikation nach auÃŸen -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'unsafe-inline'; style-src 'unsafe-inline'; img-src data:;">
    <title>Offline QR code generator</title>

    <script>
        console.log("Offline QR code generator by github.com/six-two - Dark Material UI")

        const get_or_default_int = (name, def) => {
            const stored = localStorage.getItem(name);
            if (stored != null) {
                try { return parseInt(stored); } catch {}
            }
            return def;
        };

        // ===== User settings =====
        let ERROR_CORRECTION_LEVEL = localStorage.getItem("ERROR_CORRECTION_LEVEL") || "L";
        let SHOW_CLIPBOARD_MONITORING_CONTROLS = true;

        let QR_MIN_SIZE = get_or_default_int("QR_MIN_SIZE", 30);
        let QR_MAX_SIZE = get_or_default_int("QR_MAX_SIZE", Infinity);

        let QR_BORDER_SIZE = get_or_default_int("QR_BORDER_SIZE", 0);
        let QR_BORDER_COLOR = localStorage.getItem("QR_BORDER_COLOR") || "#909090";

        let QR_BLACK = localStorage.getItem("QR_BLACK") || "black";
        let QR_WHITE = localStorage.getItem("QR_WHITE") || "white";
        let QR_SCALE  = get_or_default_int("QR_SCALE", 2);

        let USE_PNG_DOWNLOAD = (localStorage.getItem("USE_PNG_DOWNLOAD") || "true") == "true";
        // =========================
    </script>

    <style>
        :root{
            /* Material 3 â€“ Dark */
            --md-primary: #B69DF8;
            --md-on-primary: #381E72;

            --md-surface: #121212;
            --md-on-surface: #E6E1E5;

            --md-surface-variant: #2A2A2A;   /* Kartenrand/FlÃ¤chen */
            --md-outline: #3C3C3C;

            --md-card: #1E1E1E;
            --md-card-elev: #232323;

            --shadow: 0 1px 2px rgba(0,0,0,.5), 0 2px 6px rgba(0,0,0,.45), 0 1px 3px rgba(0,0,0,.6);
            --shadow-lg: 0 6px 10px rgba(0,0,0,.55), 0 16px 28px rgba(0,0,0,.6);

            --radius: 12px;
            --gap: 12px;

            /* Fehlerfarben (Dark) */
            --err-bg: #3b1a1a;
            --err-br: #B3261E;
            --err-fg: #F2B8B5;
        }

        * { box-sizing: border-box; }

        html, body {
            height: 100%;
            margin: 0;
            background: var(--md-surface);
            color: var(--md-on-surface);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", Arial, sans-serif;
        }

        /* Top App Bar */
        header.appbar{
            display: flex;
            align-items: center;
            gap: 12px;
            height: 64px;
            padding: 0 16px;
            background: #1C1B1F;            /* Dark surface-tonal */
            color: var(--md-on-surface);
            box-shadow: var(--shadow);
            position: relative;
            z-index: 1;
            border-bottom: 1px solid var(--md-outline);
        }
        .title{ font-size: 18px; font-weight: 600; letter-spacing: .15px; }
        .expand{ flex: 1; }

        /* Buttons */
        .btn{
            appearance: none;
            border: none;
            background: transparent;
            color: var(--md-on-surface);
            padding: 10px 12px;
            border-radius: 8px;
            font: inherit;
            cursor: pointer;
            position: relative;
            outline: none;
        }
        .btn:focus-visible{ box-shadow: 0 0 0 3px rgba(182,157,248,.25); }
        .btn-text:hover{ background: rgba(230,225,229,.06); }
        .btn-tonal{
            background: #2B2930;
            color: var(--md-on-surface);
            border: 1px solid var(--md-outline);
        }
        .btn-tonal:hover{ filter: brightness(1.05); }

        .ripple{
            position: absolute; border-radius: 9999px; transform: scale(0);
            animation: ripple .5s linear;
            background: currentColor; opacity: .18; pointer-events: none;
        }
        @keyframes ripple{ to{ transform: scale(4); opacity: 0; } }

        /* Layout */
        #text-and-qr{
            display: flex;
            gap: var(--gap);
            padding: var(--gap);
            height: calc(100% - 64px);
        }

        /* Settings card */
        #settings{
            display: none;
            flex-direction: column;
            gap: 10px;
            padding: 14px;
            margin: var(--gap);
            background: var(--md-card);
            border: 1px solid var(--md-outline);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        #settings .section-title{ font-weight: 600; margin-bottom: 4px; }

        /* Fields */
        .field{ display: grid; gap: 6px; }
        .field label{ font-size: 12px; color: #B0A7B6; }
        .field select, .field input{
            border: 1px solid var(--md-outline);
            background: #2A2A2A;
            color: var(--md-on-surface);
            padding: 10px 12px;
            border-radius: 8px;
            outline: none;
        }
        .field select:focus, .field input:focus{
            border-color: var(--md-primary);
            box-shadow: 0 0 0 3px rgba(182,157,248,.18);
        }

        /* Input area */
        #input-div{
            min-width: 70%;
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        #input-div .card{
            flex: 1; 
            display: flex;
            padding: 0; overflow: hidden;
            background: var(--md-card);
            border: 1px solid var(--md-outline);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        #input{
            flex: 1; 
            width: 100%; height: 100%;
            min-height: 0;
            border: none; resize: none; outline: none;
            padding: 14px;
            background: transparent;
            font: 14px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
            color: var(--md-on-surface);
        }

        #input-error{
            display: none;
            border-radius: 10px;
            padding: 10px 12px;
            border: 1px solid var(--err-br);
            background: var(--err-bg);
            color: var(--err-fg);
            box-shadow: var(--shadow);
        }

        /* QR area */
        #qrcode{
            flex: 1;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            background: #c2c5cc;
            border: 1px solid var(--md-outline);
            box-shadow: var(--shadow-lg);
        }
        #qrcode svg{
        margin: 5px;
        width: 90%;
        height: auto;   /* keep proportions */
        max-width: 400px; /* optional hard cap */
        display: block;
        }
        #qrcode canvas{             
            margin: auto;
            display: block; 
        }
        #qrcode .error{
            width: 50%;
            background: var(--err-bg);
            border: 1px solid var(--err-br);
            border-radius: 10px;
            padding: 10px 12px;
            color: var(--err-fg);
        }

        @media (max-width: 900px){ #text-and-qr{ flex-direction: column; } }
    </style>
</head>
<body>
    <header id="header" class="appbar">
        <div class="title" title="Version 2025-02-07">Offline QR code generator</div>
        <div class="expand"></div>

        <button id="button-settings" class="btn btn-text">Settings</button>
        <!-- <a id="download" href="" download class="btn btn-text">Download</a> -->
    </header>

    <!-- Einstellungen -->
    <div id="settings">
        <div class="section-title">Settings</div>

        <div class="field">
            <label><abbr title="HÃ¶here Stufe = grÃ¶ÃŸerer Code, weniger Inhalt, aber robuster">Error correction level</abbr></label>
            <select id="setting-ecc">
                <option value="H">High (bis 30% Schaden, max. 1273 Byte)</option>
                <option value="Q">Quartile (bis 25% Schaden, max. 1663 Byte)</option>
                <option value="M">Medium (bis 15% Schaden, max. 2331 Byte)</option>
                <option value="L">Low (bis 7% Schaden, max. 2953 Byte)</option>
            </select>
        </div>

        <div class="field">
            <label><abbr title="Beim Klick auf den QR-Code">QR code download format</abbr></label>
            <select id="setting-format">
                <option value="true">PNG</option>
                <option value="false">SVG</option>
            </select>
        </div>

        <div class="field">
            <label>Border size</label>
            <input id="setting-border-size" />
        </div>

        <div class="field">
            <label><abbr title="Pixel pro Modul">QR scale</abbr></label>
            <input id="setting-scale" />
        </div>

        <div class="field">
            <label>Black color</label>
            <input id="setting-color-black" />
        </div>

        <div class="field">
            <label>White color</label>
            <input id="setting-color-white" />
        </div>

        <button id="monitor-clipboard" class="btn btn-tonal"></button>
    </div>

    <div id="text-and-qr">
        <div id="input-div">
            <div id="input-error"></div>
            <div class="card">
<textarea id="input" name="input" placeholder="Text eingeben, einfÃ¼gen oder Datei hineinziehen. Der Text wird als QR-Code gerendert." autofocus>-</textarea>
            </div>
        </div>

        <div id="qrcode"><div class="error">You need to enable JavaScript to use this page</div></div>
    </div>

<script type="text/javascript">
    // Ripple
    const addRipple = (el) => {
        el.addEventListener('click', (e) => {
            const r = document.createElement('span');
            const rect = el.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            r.className = 'ripple';
            r.style.width = r.style.height = size + 'px';
            r.style.left = (e.clientX - rect.left - size/2) + 'px';
            r.style.top  = (e.clientY - rect.top  - size/2) + 'px';
            el.appendChild(r);
            setTimeout(()=>r.remove(), 500);
        });
    };
    document.querySelectorAll('.btn').forEach(addRipple);

    const header = document.getElementById("header");
    const qrcode = document.getElementById("qrcode");
    const input_area = document.getElementById("input");
    const input_error = document.getElementById("input-error");
    const text_and_qr = document.getElementById("text-and-qr");
    const settings_div = document.getElementById("settings");
    const ecc_dropdown = document.getElementById("setting-ecc");
    const format_dropdown = document.getElementById("setting-format");
    const settings_button = document.getElementById("button-settings");
    const borderSizeTextbox = document.getElementById("setting-border-size");
    const colorBlackTextbox = document.getElementById("setting-color-black");
    const colorWhiteTextbox = document.getElementById("setting-color-white");
    const scaleTextbox = document.getElementById("setting-scale");

    let ecc_level = "TODO";
    let max_size_digits = "TODO";
    let max_size_alpha_numeric = "TODO";
    let max_size_byte = "TODO";
    let estimated_size_emoji = "TODO";

    window.addEventListener("load", () => { setEccLevel(ERROR_CORRECTION_LEVEL); })

    const onHashUpdate = () => {
        if (location.hash.length > 1) {
            let initial = decodeURIComponent(location.hash.slice(1));
            input_area.value = initial;
        }
    };
    onHashUpdate();
    window.addEventListener("hashchange", onHashUpdate);

    const PADDING = 10;

    const showInputError = (m) => {
        if (m) { input_error.textContent = m; input_error.style.display = "block"; }
        else { input_error.style.display = "none"; }
    };

    const showQrCodeGenerationError = (message) => {
        qrcode.innerHTML = `<div class="error"><b>QR code generation failed:</b><br>${message}</div>`;
    };

    const updateQRCode = () => {
        const max_size_fit_window = Math.min(qrcode.clientWidth, qrcode.clientHeight, QR_MAX_SIZE);
        const qr_size = Math.max(QR_MIN_SIZE, max_size_fit_window) - 10;
        const text = input_area.value;

        if (!text) { showQrCodeGenerationError("Enter text to render a QR code."); return; }

        try {
            window.qr_code_object = qrcodegen.QrCode.encodeText(text, ecc_level);
            window.qr_code_svg = toSvgString(qr_code_object, QR_BORDER_SIZE, QR_WHITE, QR_BLACK);
            qrcode.innerHTML = window.qr_code_svg;
        } catch (error) {
            window.qr_code_svg = null;
            window.qr_code_object = null;
            let suggestions = '<li><a href="javascript:fixByCuttingTextOfAfterQrCodeMaximumSize()">Cut to maximum size</a>';
            if (/[^A-Z0-9 $%*+.\/:-]+/.test(text)) {
                suggestions += '<li><a href="javascript:tryFixByConvertingToAlphaNum()">Convert to alphanumeric</a>';
            }
            if (ecc_level != qrcodegen.QrCode.Ecc.LOW) {
                suggestions += `<li><a href="javascript:setEccLevel('L')">Use lowest error correction level</a>`;
            }
            suggestions += `<li><a href="qr-zip.html#${encodeURIComponent(text)}">ZIP into QR</a>`;

            showQrCodeGenerationError(`Text length ${text.length}. Limits depend on content and ECC.
<ul>
<li>digits -> ${max_size_digits}
<li>alphanumeric -> ${max_size_alpha_numeric}
<li>byte -> ${max_size_byte}
<li>emoji (no modifiers) -> ~${estimated_size_emoji}
</ul>
<ul>${suggestions}</ul>`);
        }
    };

    const setEccLevel = (lvlStr) => {
        const MAP = {
            "L": qrcodegen.QrCode.Ecc.LOW,
            "M": qrcodegen.QrCode.Ecc.MEDIUM,
            "Q": qrcodegen.QrCode.Ecc.QUARTILE,
            "H": qrcodegen.QrCode.Ecc.HIGH,
        };
        try { ecc_level = MAP[lvlStr]; } catch { ecc_level = qrcodegen.QrCode.Ecc.LOW; }

        max_size_digits = getMaxQrCodeLength("0", ecc_level);
        max_size_alpha_numeric = getMaxQrCodeLength("A", ecc_level);
        max_size_byte = getMaxQrCodeLength("a", ecc_level);
        estimated_size_emoji = getMaxQrCodeLength("ðŸ˜€", ecc_level);

        if (ecc_dropdown.value != lvlStr) ecc_dropdown.value = lvlStr;
    };

    const fixByCuttingTextOfAfterQrCodeMaximumSize = () => {
        input_area.value = getMaxQrCodeString(input_area.value, ecc_level);
    };
    const tryFixByConvertingToAlphaNum = () => {
        input_area.value = unicodeToAlphanumericOnly(input_area.value);
    };

    const unicodeToAlphanumericOnly = (s) => {
        s = s.replaceAll("\t", "    ").replaceAll(/\s/g, " ");
        s = s.normalize("NFD").toUpperCase();
        s = s.replaceAll(/[^A-Z0-9 $%*+.\/:-]+/g, "");
        return s;
    };
    window.test = unicodeToAlphanumericOnly;

    const getMaxQrCodeLength = (ch, ecc_level) => {
        const str = ch.repeat(7089);
        return getMaxQrCodeString(str, ecc_level).length;
    };

    const getMaxQrCodeString = (s, ecc_level) => {
        try { qrcodegen.QrCode.encodeText(s, ecc_level); return s; }
        catch {
            let min = 0, max = s.length;
            while (min < max) {
                const mid = Math.ceil((min + max) / 2);
                try { qrcodegen.QrCode.encodeText(s.slice(0, mid), ecc_level); min = mid; }
                catch { max = mid - 1; }
            }
            return s.slice(0, min);
        }
    };

    const handleFileUpload = (files) => {
        if (files.length == 1) {
            files[0].text().then(txt => {
                input_area.value = txt; showInputError(); updateQRCode();
            }).catch(err => showInputError(`Error reading the file: ${err}`));
        } else {
            showInputError(`Received ${files.length} files. Please use only one file at a time.`);
        }
    };

    document.addEventListener("paste", e => {
        if (e.clipboardData.files.length == 0) return;
        e.preventDefault(); handleFileUpload(e.clipboardData.files);
    });

    input_area.addEventListener("drop", e => {
        e.preventDefault(); handleFileUpload(e.dataTransfer.files); return false;
    });

    const download_qr_code_as_file = () => {
        if (!window.qr_code_svg) return;
        const use_png = USE_PNG_DOWNLOAD;
        const a = document.createElement("a");
        const date_string = new Date().toISOString().replace("T", "_").replace(/\.\d+.$/, "_UTC").replaceAll(":", "-");
        a.href = get_qr_code_data_url(use_png);
        a.download = `qr_code_${date_string}.${use_png ? "png" : "svg"}`;
        a.click();
    };

    const get_qr_code_data_url = (use_png) => {
        if (use_png) {
            const canvas = document.createElement("canvas");
            drawCanvas(window.qr_code_object, QR_SCALE, QR_BORDER_SIZE, QR_WHITE, QR_BLACK, canvas);
            return canvas.toDataURL("image/png");
        } else {
            const blob = new Blob([window.qr_code_svg], {type:"application/octet-stream"});
            return URL.createObjectURL(blob);
        }
    };
    qrcode.addEventListener("click", download_qr_code_as_file);
    qrcode.style.cursor = "pointer";

    input_area.addEventListener("input", updateQRCode);

    const on_window_resize = () => {
        const width = text_and_qr.clientWidth;
        const height = text_and_qr.clientHeight;
        if (!width || !height) return;

        text_and_qr.style.flexDirection = (width < 900) ? "column" : "row";
        updateQRCode();
    };
    window.addEventListener("resize", on_window_resize);
    setInterval(on_window_resize, 1000);
    setTimeout(on_window_resize, 10);

    // Settings bindings
    ecc_dropdown.value = ERROR_CORRECTION_LEVEL;
    ecc_dropdown.addEventListener("change", () => {
        ERROR_CORRECTION_LEVEL = ecc_dropdown.value;
        localStorage.setItem("ERROR_CORRECTION_LEVEL", ERROR_CORRECTION_LEVEL);
        setEccLevel(ERROR_CORRECTION_LEVEL);
    });

    format_dropdown.value = USE_PNG_DOWNLOAD;
    format_dropdown.addEventListener("change", () => {
        USE_PNG_DOWNLOAD = format_dropdown.value == "true";
        localStorage.setItem("USE_PNG_DOWNLOAD", USE_PNG_DOWNLOAD);
    });

    borderSizeTextbox.value = QR_BORDER_SIZE;
    borderSizeTextbox.addEventListener("change", () => {
        QR_BORDER_SIZE = parseInt(borderSizeTextbox.value);
        localStorage.setItem("QR_BORDER_SIZE", `${QR_BORDER_SIZE}`);
    });

    scaleTextbox.value = QR_SCALE;
    scaleTextbox.addEventListener("change", () => {
        QR_SCALE = parseInt(scaleTextbox.value);
        localStorage.setItem("QR_SCALE", `${QR_SCALE}`);
    });

    colorBlackTextbox.value = QR_BLACK;
    colorBlackTextbox.addEventListener("change", () => {
        QR_BLACK = colorBlackTextbox.value;
        localStorage.setItem("QR_BLACK", `${QR_BLACK}`);
    });

    colorWhiteTextbox.value = QR_WHITE;
    colorWhiteTextbox.addEventListener("change", () => {
        QR_WHITE = colorWhiteTextbox.value;
        localStorage.setItem("QR_WHITE", `${QR_WHITE}`);
    });

    settings_button.addEventListener("click", () => {
        const visible = settings_div.style.display == "flex";
        settings_div.style.display = visible ? "none" : "flex";
        settings_button.innerText = visible ? "Settings" : "Hide settings";
    });

/* ===== Nayuki QR Code Generator (minified) ===== */
'use strict';var qrcodegen;(function(q){function m(b,a,c){if(0>a||31<a||0!=b>>>a)throw new RangeError("Value out of range");for(--a;0<=a;a--)c.push(b>>>a&1)}function h(b){if(!b)throw Error("Assertion error");}class e{constructor(b,a,c,d){this.version=b;this.errorCorrectionLevel=a;this.modules=[];this.isFunction=[];if(b<e.MIN_VERSION||b>e.MAX_VERSION)throw new RangeError("Version value out of range");if(-1>d||7<d)throw new RangeError("Mask value out of range");this.size=4*b+17;b=[];for(a=0;a<this.size;a++)b.push(!1);for(a=0;a<this.size;a++)this.modules.push(b.slice()),this.isFunction.push(b.slice());this.drawFunctionPatterns();c=this.addEccAndInterleave(c);this.drawCodewords(c);if(-1==d)for(c=1E9,b=0;8>b;b++)this.applyMask(b),this.drawFormatBits(b),a=this.getPenaltyScore(),a<c&&(d=b,c=a),this.applyMask(b);h(0<=d&&7>=d);this.mask=d;this.applyMask(d);this.drawFormatBits(d);this.isFunction=[]}static encodeText(b,a){b=q.QrSegment.makeSegments(b);return e.encodeSegments(b,a)}static encodeBinary(b,a){b=q.QrSegment.makeBytes(b);return e.encodeSegments([b],a)}static encodeSegments(b,a,c=1,d=40,g=-1,f=!0){if(!(e.MIN_VERSION<=c&&c<=d&&d<=e.MAX_VERSION)||-1>g||7<g)throw new RangeError("Invalid value");for(;;c++){const p=8*e.getNumDataCodewords(c,a),n=k.getTotalBits(b,c);if(n<=p){d=n;break}if(c>=d)throw new RangeError("Data too long");}for(const p of[e.Ecc.MEDIUM,e.Ecc.QUARTILE,e.Ecc.HIGH])f&&d<=8*e.getNumDataCodewords(c,p)&&(a=p);f=[];for(var l of b){m(l.mode.modeBits,4,f);m(l.numChars,l.mode.numCharCountBits(c),f);for(const p of l.getData())f.push(p)}h(f.length==d);b=8*e.getNumDataCodewords(c,a);h(f.length<=b);m(0,Math.min(4,b-f.length),f);m(0,(8-f.length%8)%8,f);h(0==f.length%8);for(l=236;f.length<b;l^=253)m(l,8,f);let r=[];for(;8*r.length<f.length;)r.push(0);f.forEach((p,n)=>r[n>>>3]|=p<<7-(n&7));return new e(c,a,r,g)}getModule(b,a){return 0<=b&&b<this.size&&0<=a&&a<this.size&&this.modules[a][b]}drawFunctionPatterns(){for(var b=0;b<this.size;b++)this.setFunctionModule(6,b,0==b%2),this.setFunctionModule(b,6,0==b%2);this.drawFinderPattern(3,3);this.drawFinderPattern(this.size-4,3);this.drawFinderPattern(3,this.size-4);b=this.getAlignmentPatternPositions();const a=b.length;for(let c=0;c<a;c++)for(let d=0;d<a;d++)0==c&&0==d||0==c&&d==a-1||c==a-1&&0==d||this.drawAlignmentPattern(b[c],b[d]);this.drawFormatBits(0);this.drawVersion()}drawFormatBits(b){var a=b|=this.errorCorrectionLevel.formatBits<<3;for(let c=0;10>c;c++)a=a<<1^1335*(a>>>9);b=(b<<10|a)^21522;h(0==b>>>15);for(a=0;5>=a;a++)this.setFunctionModule(8,a,0!=(b>>>a&1));this.setFunctionModule(8,7,0!=(b>>>6&1));this.setFunctionModule(8,8,0!=(b>>>7&1));this.setFunctionModule(7,8,0!=(b>>>8&1));for(a=9;15>a;a++)this.setFunctionModule(14-a,8,0!=(b>>>a&1));for(a=0;8>a;a++)this.setFunctionModule(this.size-1-a,8,0!=(b>>>a&1));for(a=8;15>a;a++)this.setFunctionModule(8,this.size-15+a,0!=(b>>>a&1));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(!(7>this.version)){var b=this.version;for(var a=0;12>a;a++)b=b<<1^7973*(b>>>11);b|=this.version<<12;h(0==b>>>18);for(a=0;18>a;a++){const c=0!=(b>>>a&1),d=this.size-11+a%3,g=Math.floor(a/3);this.setFunctionModule(d,g,c);this.setFunctionModule(g,d,c)}}}drawFinderPattern(b,a){for(let c=-4;4>=c;c++)for(let d=-4;4>=d;d++){const g=Math.max(Math.abs(d),Math.abs(c)),f=b+d,l=a+c;0<=f&&f<this.size&&0<=l&&l<this.size&&this.setFunctionModule(f,l,2!=g&&4!=g)}}drawAlignmentPattern(b,a){for(let c=-2;2>=c;c++)for(let d=-2;2>=d;d++)this.setFunctionModule(b+d,a+c,1!=Math.max(Math.abs(d),Math.abs(c)))}setFunctionModule(b,a,c){this.modules[a][b]=c;this.isFunction[a][b]=!0}addEccAndInterleave(b){var a=this.version,c=this.errorCorrectionLevel;if(b.length!=e.getNumDataCodewords(a,c))throw new RangeError("Invalid argument");const d=e.NUM_ERROR_CORRECTION_BLOCKS[c.ordinal][a],g=e.ECC_CODEWORDS_PER_BLOCK[c.ordinal][a];a=Math.floor(e.getNumRawDataModules(a)/8);const f=d-a%d,l=Math.floor(a/d);c=[];const r=e.reedSolomonComputeDivisor(g);for(let n=0,u=0;n<d;n++){let t=b.slice(u,u+l-g+(n<f?0:1));u+=t.length;const v=e.reedSolomonComputeRemainder(t,r);n<f&&t.push(0);c.push(t.concat(v))}let p=[];for(let n=0;n<c[0].length;n++)c.forEach((u,t)=>{(n!=l-g||t>=f)&&p.push(u[n])});h(p.length==a);return p}drawCodewords(b){if(b.length!=Math.floor(e.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let a=0;for(let c=this.size-1;1<=c;c-=2){6==c&&(c=5);for(let d=0;d<this.size;d++)for(let g=0;2>g;g++){const f=c-g,l=0==(c+1&2)?this.size-1-d:d;!this.isFunction[l][f]&&a<8*b.length&&(this.modules[l][f]=0!=(b[a>>>3]>>>7-(a&7)&1),a++)}}h(a==8*b.length)}applyMask(b){if(0>b||7<b)throw new RangeError("Mask value out of range");for(let a=0;a<this.size;a++)for(let c=0;c<this.size;c++){let d;switch(b){case 0:d=0==(c+a)%2;break;case 1:d=0==a%2;break;case 2:d=0==c%3;break;case 3:d=0==(c+a)%3;break;case 4:d=0==(Math.floor(c/3)+Math.floor(a/2))%2;break;case 5:d=0==c*a%2+c*a%3;break;case 6:d=0==(c*a%2+c*a%3)%2;break;case 7:d=0==((c+a)%2+c*a%3)%2;break;default:throw Error("Unreachable");}!this.isFunction[a][c]&&d&&(this.modules[a][c]=!this.modules[a][c])}}getPenaltyScore(){let b=0;for(var a=0;a<this.size;a++){var c=!1,d=0,g=[0,0,0,0,0,0,0];for(var f=0;f<this.size;f++)this.modules[a][f]==c?(d++,5==d?b+=e.PENALTY_N1:5<d&&b++):(this.finderPenaltyAddHistory(d,g),c||(b+=this.finderPenaltyCountPatterns(g)*e.PENALTY_N3),c=this.modules[a][f],d=1);b+=this.finderPenaltyTerminateAndCount(c,d,g)*e.PENALTY_N3}for(a=0;a<this.size;a++){c=!1;d=0;g=[0,0,0,0,0,0,0];for(f=0;f<this.size;f++)this.modules[f][a]==c?(d++,5==d?b+=e.PENALTY_N1:5<d&&b++):(this.finderPenaltyAddHistory(d,g),c||(b+=this.finderPenaltyCountPatterns(g)*e.PENALTY_N3),c=this.modules[f][a],d=1);b+=this.finderPenaltyTerminateAndCount(c,d,g)*e.PENALTY_N3}for(a=0;a<this.size-1;a++)for(c=0;c<this.size-1;c++)d=this.modules[a][c],d==this.modules[a][c+1]&&d==this.modules[a+1][c]&&d==this.modules[a+1][c+1]&&(b+=e.PENALTY_N2);a=0;for(var l of this.modules)a=l.reduce((r,p)=>r+(p?1:0),a);l=this.size*this.size;l=Math.ceil(Math.abs(20*a-10*l)/l)-1;h(0<=l&&9>=l);b+=l*e.PENALTY_N4;h(0<=b&&2568888>=b);return b}getAlignmentPatternPositions(){if(1==this.version)return[];const b=Math.floor(this.version/7)+2,a=32==this.version?26:2*Math.ceil((4*this.version+4)/(2*b-2));let c=[6];for(let d=this.size-7;c.length<b;d-=a)c.splice(1,0,d);return c}static getNumRawDataModules(b){if(b<e.MIN_VERSION||b>e.MAX_VERSION)throw new RangeError("Version number out of range");let a=(16*b+128)*b+64;if(2<=b){const c=Math.floor(b/7)+2;a-=(25*c-10)*c-55;7<=b&&(a-=36)}h(208<=a&&29648>=a);return a}static getNumDataCodewords(b,a){return Math.floor(e.getNumRawDataModules(b)/8)-e.ECC_CODEWORDS_PER_BLOCK[a.ordinal][b]*e.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][b]}static reedSolomonComputeDivisor(b){if(1>b||255<b)throw new RangeError("Degree out of range");let a=[];for(var c=0;c<b-1;c++)a.push(0);a.push(1);c=1;for(let d=0;d<b;d++){for(let g=0;g<a.length;g++)a[g]=e.reedSolomonMultiply(a[g],c),g+1<a.length&&(a[g]^=a[g+1]);c=e.reedSolomonMultiply(c,2)}return a}static reedSolomonComputeRemainder(b,a){let c=a.map(d=>0);for(const d of b){const g=d^c.shift();c.push(0);a.forEach((f,l)=>c[l]^=e.reedSolomonMultiply(f,g))}return c}static reedSolomonMultiply(b,a){if(0!=b>>>8||0!=a>>>8)throw new RangeError("Byte out of range");let c=0;for(let d=7;0<=d;d--)c=c<<1^285*(c>>>7),c^=(a>>>d&1)*b;h(0==c>>>8);return c}finderPenaltyCountPatterns(b){const a=b[1];h(a<=3*this.size);const c=0<a&&b[2]==a&&b[3]==3*a&&b[4]==a&&b[5]==a;return(c&&b[0]>=4*a&&b[6]>=a?1:0)+(c&&b[6]>=4*a&&b[0]>=a?1:0)}finderPenaltyTerminateAndCount(b,a,c){b&&(this.finderPenaltyAddHistory(a,c),a=0);a+=this.size;this.finderPenaltyAddHistory(a,c);return this.finderPenaltyCountPatterns(c)}finderPenaltyAddHistory(b,a){0==a[0]&&(b+=this.size);a.pop();a.unshift(b)}}e.MIN_VERSION=1;e.MAX_VERSION=40;e.PENALTY_N1=3;e.PENALTY_N2=3;e.PENALTY_N3=40;e.PENALTY_N4=10;e.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]];e.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];q.QrCode=e;class k{constructor(b,a,c){this.mode=b;this.numChars=a;this.bitData=c;if(0>a)throw new RangeError("Invalid argument");this.bitData=c.slice()}static makeBytes(b){let a=[];for(const c of b)m(c,8,a);return new k(k.Mode.BYTE,b.length,a)}static makeNumeric(b){if(!k.isNumeric(b))throw new RangeError("String contains non-numeric characters");let a=[];for(let c=0;c<b.length;){const d=Math.min(b.length-c,3);m(parseInt(b.substr(c,d),10),3*d+1,a);c+=d}return new k(k.Mode.NUMERIC,b.length,a)}static makeAlphanumeric(b){if(!k.isAlphanumeric(b))throw new RangeError("String contains unencodable characters in alphanumeric mode");let a=[],c;for(c=0;c+2<=b.length;c+=2){let d=45*k.ALPHANUMERIC_CHARSET.indexOf(b.charAt(c));d+=k.ALPHANUMERIC_CHARSET.indexOf(b.charAt(c+1));m(d,11,a)}c<b.length&&m(k.ALPHANUMERIC_CHARSET.indexOf(b.charAt(c)),6,a);return new k(k.Mode.ALPHANUMERIC,b.length,a)}static makeSegments(b){return""==b?[]:k.isNumeric(b)?[k.makeNumeric(b)]:k.isAlphanumeric(b)?[k.makeAlphanumeric(b)]:[k.makeBytes(k.toUtf8ByteArray(b))]}static makeEci(b){let a=[];if(0>b)throw new RangeError("ECI assignment value out of range");if(128>b)m(b,8,a);else if(16384>b)m(2,2,a),m(b,14,a);else if(1E6>b)m(6,3,a),m(b,21,a);else throw new RangeError("ECI assignment value out of range");return new k(k.Mode.ECI,0,a)}static isNumeric(b){return k.NUMERIC_REGEX.test(b)}static isAlphanumeric(b){return k.ALPHANUMERIC_REGEX.test(b)}getData(){return this.bitData.slice()}static getTotalBits(b,a){let c=0;for(const d of b){b=d.mode.numCharCountBits(a);if(d.numChars>=1<<b)return Infinity;c+=4+b+d.bitData.length}return c}static toUtf8ByteArray(b){b=encodeURI(b);let a=[];for(let c=0;c<b.length;c++)"%"!=b.charAt(c)?a.push(b.charCodeAt(c)):(a.push(parseInt(b.substr(c+1,2),16)),c+=2);return a}}k.NUMERIC_REGEX=/^[0-9]*$/;k.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/;k.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";q.QrSegment=k})(qrcodegen||={});(function(q){(function(m){class h{constructor(e,k){this.ordinal=e;this.formatBits=k}}h.LOW=new h(0,1);h.MEDIUM=new h(1,0);h.QUARTILE=new h(2,3);h.HIGH=new h(3,2);m.Ecc=h})(q.QrCode||(q.QrCode={}))})(qrcodegen||={});(function(q){(function(m){class h{constructor(e,k){this.modeBits=e;this.numBitsCharCount=k}numCharCountBits(e){return this.numBitsCharCount[Math.floor((e+7)/17)]}}h.NUMERIC=new h(1,[10,12,14]);h.ALPHANUMERIC=new h(2,[9,11,13]);h.BYTE=new h(4,[8,16,16]);h.KANJI=new h(8,[8,10,12]);h.ECI=new h(7,[0,0,0]);m.Mode=h})(q.QrSegment||(q.QrSegment={}))})(qrcodegen||={});

    // Render helpers
    function toSvgString(qr, border, lightColor, darkColor) {
        if (border < 0) throw new RangeError("Border must be non-negative");
        let parts = [];
        for (let y = 0; y < qr.size; y++) {
            for (let x = 0; x < qr.size; x++) if (qr.getModule(x, y))
                parts.push(`M${x + border},${y + border}h1v1h-1z`);
        }
        return `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 ${qr.size + border * 2} ${qr.size + border * 2}" stroke="none">
  <rect width="100%" height="100%" fill="${lightColor}"/>
  <path d="${parts.join(" ")}" fill="${darkColor}"/>
</svg>
`;
    }
    function drawCanvas(qr, scale, border, lightColor, darkColor, canvas) {
        if (scale <= 0 || border < 0) throw new RangeError("Value out of range");
        const width = (qr.size + border * 2) * scale;
        canvas.width = width; canvas.height = width;
        let ctx = canvas.getContext("2d");
        for (let y = -border; y < qr.size + border; y++) {
            for (let x = -border; x < qr.size + border; x++) {
                ctx.fillStyle = qr.getModule(x, y) ? darkColor : lightColor;
                ctx.fillRect((x + border) * scale, (y + border) * scale, scale, scale);
            }
        }
    }
</script>
</body>
</html>
